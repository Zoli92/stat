---
title: "Beadandó"
author: "Gugolya Zoltán és Pegán Ágnes"
output:
  pdf_document:
    toc: true
---

### Könyvtárak betöltése

```{r, warning=FALSE, message = FALSE}
  library(readxl)
  library(dplyr)
  library(tidyr)
  library(ggplot2)
  options(digits=5)
  Sys.setlocale("LC_ALL", "en_US.UTF-8")
```
### Adatok betöltése és átalakítása
```{r}
  megye_lista <- c("Bacs-Kiskun", "Baranya", "Bekes", "Borsod-Abauj-Zemplen", "Budapest", 
                   "Csongrad-Csanad", "Fejer", "Gyor-Moson-Sopron", "Hajdu-Bihar", "Heves", 
                   "Jasz-Nagykun-Szolnok", "Komarom-Esztergom", "Nograd", "Pest", "Somogy", 
                   "Szabolcs-Szatmar-Bereg", "Tolna", "Vas", "Veszprem", "Zala")
  
  
  data <- list()
  
  i <- 1
  for (megye in megye_lista) {
    sheet_data <- read_excel("data.xlsx", sheet = i) %>% 
      rename(Tulajdonsag = 1, Year_2010 = 2, Year_2018 = 3) %>% 
      mutate(Megye = megye)
  
    data[[megye]] <- sheet_data
    i <- i + 1
  }
  
  combined_data <- bind_rows(data)
  
  df_2010 <- combined_data %>%
    select(Tulajdonsag, Megye, Year_2010) %>%
    pivot_wider(names_from = Megye, values_from = Year_2010)
  
  df_2018 <- combined_data %>%
    select(Tulajdonsag, Megye, Year_2018) %>%
    pivot_wider(names_from = Megye, values_from = Year_2018)
```

### Érettségivel rendelkező férfiak és nők:
Látható, hogy jóval több nőnek a legmagasabb végzettsége az érettségi, mint férfinak, ami a felsőoktatásra is igaz lesz, a később láthatóak alapján. Átlagosan kb 6% ponttal több nőnek legmagasabb végzettsége az érettségi, mint férfinak. 2010 és 2018 a férfiak és nők közti különbség nőtt, mivel a nők közül 2% ponttal többen szereztek érettségit, míg a férfiak csak 1,5%. Az értékek összesen 10 esetben csökkentek, 4 megyében nőknél, 6 megyében pedig férfiaknál. A függőleges piros és kék vonalak az adott évre vonatkozó átlagot jelentik.

```{r, echo=TRUE, fig.keep='all', fig.height=4}

  no_erettsegi_szazalek <- as.numeric(df_2010[1,-1])
  ferfi_erettsegi_szazalek <- as.numeric(df_2010[2,-1])
  f_10 <- mean(ferfi_erettsegi_szazalek)
  n_10 <- mean(no_erettsegi_szazalek)

  plot_2010 <- ggplot() +
    geom_histogram(data=NULL, aes(x=no_erettsegi_szazalek, y = after_stat(count)), binwidth =2, fill="#FFC0CB", color="black") +
    geom_label(data=NULL, aes( x=4.5, y =1, label="nok"), color="#FFC0CB") +
    geom_histogram(data=NULL, aes(x=ferfi_erettsegi_szazalek, y = -after_stat(count)), binwidth =2, fill="#ADD8E6", color="black") + 
    geom_label(data=NULL, aes(x=4.5, y=-1, label="ferfiak"), color="#ADD8E6") +
    xlab("Legmagasabb vegzettsegkent erettsegivel rendkelezok szazaleka 2010-ben") +
    scale_y_continuous(breaks = seq(-10, 10, by = 1), labels = abs(seq(-10, 10, by = 1))) +
    scale_x_continuous(breaks = seq(20, 45, by = 2)) +
    geom_vline(aes(xintercept = n_10), color = "#AA0000") +
    geom_vline(aes(xintercept = f_10), color = "#0000AA")
  
  no_erettsegi_szazalek_18 <- as.numeric(df_2018[1,-1])
  ferfi_erettsegi_szazalek_18 <- as.numeric(df_2018[2,-1])
  f_18 <- mean(ferfi_erettsegi_szazalek_18)
  n_18 <- mean(no_erettsegi_szazalek_18)
  
  plot_2018 <- ggplot() +
    geom_histogram(data=NULL, aes(x=no_erettsegi_szazalek_18, y = after_stat(count)), binwidth =2, fill="#FFC0CB", color="black") +
    geom_label(data=NULL, aes( x=4.5, y =1, label="nok"), color="#FFC0CB") +
    geom_histogram(data=NULL, aes(x=ferfi_erettsegi_szazalek_18, y = -after_stat(count)), binwidth =2, fill="#ADD8E6", color="black") + 
    geom_label(data=NULL, aes(x=4.5, y=-1, label="ferfiak"), color="#ADD8E6") +
    xlab("Legmagasabb vegzettsegkent erettsegivel rendkelezok szazaleka 2018-ban") +
    scale_y_continuous(breaks = seq(-10, 10, by = 1),labels = abs(seq(-10, 10, by = 1))) +
    scale_x_continuous(breaks = seq(20, 45, by = 2)) +
    geom_vline(aes(xintercept = n_18), color = "#AA0000") +
    geom_vline(aes(xintercept = f_18), color = "#0000AA")
  
  
  plot_2010
  plot_2018
  
  #Nők és férfiak közti különbség
  n_10-f_10
  n_18-f_18
  #Eltérés 2010 és 2018 között
  f_18-f_10
  n_18-n_10
  
  kulonbseg_n <- no_erettsegi_szazalek_18 - no_erettsegi_szazalek
  kulonbseg_f <- ferfi_erettsegi_szazalek_18 - ferfi_erettsegi_szazalek
  kulonbseg_table <- data.frame(
    Megye = megye_lista,
    no_elteres = kulonbseg_n,
    ferfi_elteres = kulonbseg_f
  )
  kulonbseg_table
  #Nőknél hány megyében csökkent
  sum(kulonbseg_n < 0)
  #Férfiaknál hány megyében csökkent
  sum(kulonbseg_f < 0)
```
### Foglalkoztatottság, jövedelem

### Személygépkocsik

2010 és 18 között jelentősen növekedett az ezer főre jutó gépjárművek száma, az országos átlag majdnem 33%-al növekedett. Ami érdekes, hogy az ezer főre jutó gépjárművek számában az élen a 12 legnyugatibb megye áll mind 2010-ben és 2018-ban. Fizetésben is a nyugati országrész áll jobban, azonban ennyire nem szélsőséges ott. Az átlagtól az egyes megyék átlagban 10%-al térnek el mindkét vizsgált évben.


```{r}
  gepkocsik_10 <- df_2010[7, -1]
  hist(as.numeric(gepkocsik_10))
  colnames(gepkocsik_10)[apply(gepkocsik_10, 2, function(x) any(x > 289))]
  
  atl_2010 <- mean(as.numeric(gepkocsik_10))
  med_10<-median(as.numeric(gepkocsik_10))
  
  points(med_10, y=0, col="red", pch=19)
  text(x=med_10, y = 0.5, labels=paste("Median =", med_10), col="red")
  
  points(atl_2010, y = 0, col="red", pch=19)
  text(x=atl_2010, y = 1, labels=paste("Atlag=", atl_2010), col="red")
  
  gepkocsik_18 <- df_2018[7, -1]
  hist(as.numeric(gepkocsik_18))
  colnames(gepkocsik_18)[apply(gepkocsik_18, 2, function(x) any(x > 360))]
  
  atl_2018 = mean(as.numeric(gepkocsik_18))
  med_18<-median(as.numeric(gepkocsik_18))
  
  points(med_18, y=0, col="red", pch = 19)
  text(x=med_18, y = 0.5, labels=paste("Median =", med_18), col="red")
  
  points(atl_2018, y = 0, col="red", pch=19)
  text(x=atl_2018, y = 1, labels=paste("Atlag=", atl_2018), col="red")


  # Korrigált tapasztalti szórás
  sd(as.numeric(gepkocsik_10))
  sd(as.numeric(gepkocsik_18))
  
  #Szórási együttható
  sd(as.numeric(gepkocsik_10))/atl_2010
  sd(as.numeric(gepkocsik_18))/atl_2018
  
  
  # Tapasztalati szórás
  sqrt(mean((as.numeric(gepkocsik_10) - atl_2010)*(as.numeric(gepkocsik_10) - atl_2010)))
  sqrt(mean((as.numeric(gepkocsik_18) - atl_2018)*(as.numeric(gepkocsik_18) - atl_2018)))
```
### Jövedelem
A boxplot ábrán is jól látható a két vizsgált év közötti különbség. Outlier elemek nincsenek, az A pont és az E pont értékei minden esetben az adatok közül valóak, nem pedig az interkvartilis terjedelemmel kiszámolt érték. A legmagasabbb érték mindkét esetben természetesen Budapest, míg a legalacsonyabb Szabolcs-Szatmár-Bereg megye.

```{r}
  jovedelem_10 <- as.numeric(df_2010[9, -1])
  
  jovedelem_18 <- as.numeric(df_2018[9, -1])

  jov_med_10 <- median(jovedelem_10)
  jov_med_18 <- median(jovedelem_18)
  
  mean(jovedelem_10)
  mean(jovedelem_18)
  
  q1_10 <- quantile(jovedelem_10, 0.25)
  q3_10 <- quantile(jovedelem_10, 0.75)
  IQR_10 <- q3_10 - q1_10
  
  min(jovedelem_10)
  q1_10-1.5*IQR_10
  
  max(jovedelem_10)
  q3_10+1.5*IQR_10
  
  q1_18 <- quantile(jovedelem_18, 0.25)
  q3_18 <- quantile(jovedelem_18, 0.75)
  IQR_18 <- q3_18 - q1_18
  
  min(jovedelem_18)
  q1_18-1.5*IQR_18
  
  max(jovedelem_18)
  q3_18+1.5*IQR_18
  
  boxplot_data= data.frame(
      fizetes=c(jovedelem_10, jovedelem_18),
      ev= rep(c("2010", "2018"), each= length(jovedelem_10))
    )
  ggplot(boxplot_data, aes(x=ev, y = fizetes, fill= ev)) +
    geom_boxplot() + 
    geom_point(aes(x=1, y = min(jovedelem_10)), color="red", size=3) + 
    geom_text(aes(x=1, y = min(jovedelem_10), label="A értéke a legkisebb elem a mintából"), color="red", vjust=1) +
    geom_point(aes(x=1, y=max(jovedelem_10)), color="red", size = 3) +
    geom_text(aes(x=1, y= max(jovedelem_10), label="E értéke a legnagyobb elem a mintából"), color="red", vjust=-1) +
    geom_point(aes(x = 2, y= min(jovedelem_18)), color="blue", size=3) +
    geom_text(aes(x=2, y = min(jovedelem_18), label="A értéke a legkisebb elem a mintából"), color="blue", vjust=1) +
    geom_point(aes(x=2, y=max(jovedelem_18)), color="blue", size = 3) +
    geom_text(aes(x=2, y= max(jovedelem_18), label="E értéke a legnagyobb elem a mintából"), color="blue", vjust=1)
```
###
A csúcsosság és a ferdeség által megadott értékek az ábrán is jól láthatóak
```{r}
  #Ferdeség
  sum((jovedelem_10-mean(jovedelem_10))^3)/(sd(jovedelem_10)^3)/length(jovedelem_10)
  #Mivel a ferdeség pozitív, ezért az eloszlás a szimmetrikustól jobbra nyúlik el
  
  #Lapultság
  sum((jovedelem_10-mean(jovedelem_10))^4)/(sd(jovedelem_10)^4)/length(jovedelem_10)-3
  #Mivel a lapultság pozitív, ezért az eloszlás csúcsosabb a normális eloszlásnál
  
  suruseg_10 <- density(jovedelem_10)
  plot(suruseg_10)
  curve(dnorm(x, mean = mean(jovedelem_10), sd = sd(jovedelem_10)), 
      add = TRUE, col = "red", lwd = 2)
  
  #Ferdeség
  sum((jovedelem_18-mean(jovedelem_18))^3)/(sd(jovedelem_18)^3)/length(jovedelem_18)
  #Mivel a ferdeség pozitív, ezért az eloszlás a szimmetrikustól jobbra nyúlik el
  
  #Lapultság
  sum((jovedelem_18-mean(jovedelem_18))^4)/(sd(jovedelem_18)^4)/length(jovedelem_18)-3
  #Mivel a lapultság negatív, ezért az eloszlás laposabb a normális eloszlásnál
  
  suruseg_18 <- density(jovedelem_18)
  plot(suruseg_18)
  curve(dnorm(x, mean = mean(jovedelem_18), sd = sd(jovedelem_18)), 
      add = TRUE, col = "red", lwd = 2)
  
```




