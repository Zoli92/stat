---
title: "Beadandó"
author: "Gugolya Zoltán és Pegán Ágnes"
output:
  pdf_document:
    toc: true
---

### Könyvtárak betöltése

```{r, warning=FALSE, message = FALSE}
  library(readxl)
  library(dplyr)
  library(tidyr)
  library(ggplot2)
  options(digits=5)
  Sys.setlocale("LC_ALL", "en_US.UTF-8")
```
### Adatok betöltése és átalakítása
```{r}
  megye_lista <- c("Bacs-Kiskun", "Baranya", "Bekes", "Borsod-Abauj-Zemplen", "Budapest", 
                   "Csongrad-Csanad", "Fejer", "Gyor-Moson-Sopron", "Hajdu-Bihar", "Heves", 
                   "Jasz-Nagykun-Szolnok", "Komarom-Esztergom", "Nograd", "Pest", "Somogy", 
                   "Szabolcs-Szatmar-Bereg", "Tolna", "Vas", "Veszprem", "Zala")
  
  
  data <- list()
  
  i <- 1
  for (megye in megye_lista) {
    sheet_data <- read_excel("data.xlsx", sheet = i) %>% 
      rename(Tulajdonsag = 1, Year_2010 = 2, Year_2018 = 3) %>% 
      mutate(Megye = megye)
  
    data[[megye]] <- sheet_data
    i <- i + 1
  }
  
  combined_data <- bind_rows(data)
  
  df_2010 <- combined_data %>%
    select(Tulajdonsag, Megye, Year_2010) %>%
    pivot_wider(names_from = Megye, values_from = Year_2010)
  
  df_2018 <- combined_data %>%
    select(Tulajdonsag, Megye, Year_2018) %>%
    pivot_wider(names_from = Megye, values_from = Year_2018)
```

### Érettségivel rendelkező férfiak és nők:
Látható, hogy jóval több nőnek a legmagasabb végzettsége az érettségi, mint férfinak, ami a felsőoktatásra is igaz lesz, a később láthatóak alapján. Átlagosan kb 6% ponttal több nőnek legmagasabb végzettsége az érettségi, mint férfinak. 2010 és 2018 a férfiak és nők közti különbség nőtt, mivel a nők közül 2% ponttal többen szereztek érettségit, míg a férfiak csak 1,5%. Az értékek összesen 10 esetben csökkentek, 4 megyében nőknél, 6 megyében pedig férfiaknál. A függőleges piros és kék vonalak az adott évre vonatkozó átlagot jelentik.

```{r, echo=TRUE, fig.keep='all', fig.height=4}

  no_erettsegi_szazalek <- as.numeric(df_2010[1,-1])
  ferfi_erettsegi_szazalek <- as.numeric(df_2010[2,-1])
  f_10 <- mean(ferfi_erettsegi_szazalek)
  n_10 <- mean(no_erettsegi_szazalek)

  plot_2010 <- ggplot() +
    geom_histogram(data=NULL, aes(x=no_erettsegi_szazalek, y = after_stat(count)), binwidth =2, fill="#FFC0CB") +
    geom_label(data=NULL, aes( x=4.5, y =1, label="nok"), color="#FFC0CB") +
    geom_histogram(data=NULL, aes(x=ferfi_erettsegi_szazalek, y = -after_stat(count)), binwidth =2, fill="#ADD8E6") + 
    geom_label(data=NULL, aes(x=4.5, y=-1, label="ferfiak"), color="#ADD8E6") +
    xlab("Legmagasabb vegzettsegkent erettsegivel rendkelezok szazaleka 2010-ben") +
    scale_y_continuous(breaks = seq(-10, 10, by = 1), labels = abs(seq(-10, 10, by = 1))) +
    scale_x_continuous(breaks = seq(20, 45, by = 2)) +
    geom_vline(aes(xintercept = n_10), color = "#AA0000") +
    geom_vline(aes(xintercept = f_10), color = "#0000AA")
  
  no_erettsegi_szazalek_18 <- as.numeric(df_2018[1,-1])
  ferfi_erettsegi_szazalek_18 <- as.numeric(df_2018[2,-1])
  f_18 <- mean(ferfi_erettsegi_szazalek_18)
  n_18 <- mean(no_erettsegi_szazalek_18)
  
  plot_2018 <- ggplot() +
    geom_histogram(data=NULL, aes(x=no_erettsegi_szazalek_18, y = after_stat(count)), binwidth =2, fill="#FFC0CB") +
    geom_label(data=NULL, aes( x=4.5, y =1, label="nok"), color="#FFC0CB") +
    geom_histogram(data=NULL, aes(x=ferfi_erettsegi_szazalek_18, y = -after_stat(count)), binwidth =2, fill="#ADD8E6") + 
    geom_label(data=NULL, aes(x=4.5, y=-1, label="ferfiak"), color="#ADD8E6") +
    xlab("Legmagasabb vegzettsegkent erettsegivel rendkelezok szazaleka 2018-ban") +
    scale_y_continuous(breaks = seq(-10, 10, by = 1),labels = abs(seq(-10, 10, by = 1))) +
    scale_x_continuous(breaks = seq(20, 45, by = 2)) +
    geom_vline(aes(xintercept = n_18), color = "#AA0000") +
    geom_vline(aes(xintercept = f_18), color = "#0000AA")
  
  
  plot_2010
  plot_2018
  
  #Nők és férfiak közti különbség
  n_10-f_10
  n_18-f_18
  #Eltérés 2010 és 2018 között
  f_18-f_10
  n_18-n_10
  
  kulonbseg_n <- no_erettsegi_szazalek_18 - no_erettsegi_szazalek
  kulonbseg_f <- ferfi_erettsegi_szazalek_18 - ferfi_erettsegi_szazalek
  kulonbseg_table <- data.frame(
    Megye = megye_lista,
    no_elteres = kulonbseg_n,
    ferfi_elteres = kulonbseg_f
  )
  kulonbseg_table
  #Nőknél hány megyében csökkent
  sum(kulonbseg_n < 0)
  #Férfiaknál hány megyében csökkent
  sum(kulonbseg_f < 0)
```
